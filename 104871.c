 SurfaceToPackedBGRA(DataSourceSurface *aSurface) SurfaceFormat format = aSurface -> GetFormat ( ) ; if ( format != SurfaceFormat :: B8G8R8A8 && format != SurfaceFormat :: B8G8R8X8 )  IntSize size = aSurface -> GetSize ( ) ; uint8_t * imageBuffer = new ( std :: nothrow ) uint8_t [ size . width * size . height * sizeof ( uint32_t ) ] if ( ! imageBuffer )  DataSourceSurface :: MappedSurface map ; if ( ! aSurface -> Map ( DataSourceSurface :: MapType :: READ , & map ) )  CopySurfaceDataToPackedArray ( map . mData , imageBuffer , size , map . mStride , 4 * sizeof ( uint8_t ) );  CopySurfaceDataToPackedArray(uint8_t* aSrc, uint8_t* aDst, IntSize int32_t aSrcStride, int32_t aBytesPerPixel) int packedStride = aSrcSize . width * aBytesPerPixel ; if ( aSrcStride == packedStride )  memcpy ( aDst , aSrc , packedStride * aSrcSize . height ); 