static void e100_nic_realize(PCIDevice *pci_dev, Error **errp) EEPRO100State * s = DO_UPCAST ( EEPRO100State , dev , pci_dev ) ; E100PCIDeviceInfo * info = eepro100_get_class ( s ) ; static E100PCIDeviceInfo *eepro100_get_class(EEPRO100State *s) return eepro100_get_class_by_name ( object_get_typename ( OBJECT ( s ) ) ) ; static E100PCIDeviceInfo *eepro100_get_class_by_name(const char *typename) E100PCIDeviceInfo * info = NULL ; int i ; for (i = 0; i < ARRAY_SIZE(e100_devices); i++) if ( strcmp ( e100_devices [ i ] . name , typename ) == 0 )  info = & e100_devices [ i ]; return info ; s -> device = info -> device; s -> eeprom = eeprom93xx_new ( & pci_dev -> qdev , EEPROM_SIZE ); s -> nic = qemu_new_nic ( & net_eepro100_info , & s -> conf , object_get_typename ( OBJECT ( pci_dev ) ) , pci_dev -> qdev . id , s ); s -> vmstate = g_malloc ( sizeof ( vmstate_eepro100 ) ); memcpy ( s -> vmstate , & vmstate_eepro100 , sizeof ( vmstate_eepro100 ) ); s -> vmstate -> name = qemu_get_queue ( s -> nic ) -> model; vmstate_register ( & pci_dev -> qdev , - 1 , s -> vmstate , s ); 