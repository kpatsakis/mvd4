CharDriverState *qemu_chr_open(const char *label, const char *filename, void (*init)(struct CharDriverState *s)) const char * p ; CharDriverState * chr ; if ( ! strcmp ( filename , "vc" ) )  if ( strstart ( filename , "vc:" , & p ) )  if ( ! strcmp ( filename , "null" ) )  if ( strstart ( filename , "tcp:" , & p ) )  if ( strstart ( filename , "telnet:" , & p ) )  if ( strstart ( filename , "udp:" , & p ) )  if ( strstart ( filename , "mon:" , & p ) )  chr = qemu_chr_open ( label , p , NULL ); CharDriverState *qemu_chr_open(const char *label, const char *filename, void (*init)(struct CharDriverState *s)) const char * p ; CharDriverState * chr ; if ( ! strcmp ( filename , "vc" ) )  if ( strstart ( filename , "vc:" , & p ) )  if ( ! strcmp ( filename , "null" ) )  if ( strstart ( filename , "tcp:" , & p ) )  if ( strstart ( filename , "telnet:" , & p ) )  if ( strstart ( filename , "udp:" , & p ) )  if ( strstart ( filename , "mon:" , & p ) )  chr = qemu_chr_open ( label , p , NULL ); CharDriverState *qemu_chr_open(const char *label, const char *filename, void (*init)(struct CharDriverState *s)) CharDriverState * chr ; if ( strstart ( filename , "/dev/" , NULL ) )  chr = qemu_chr_open_tty ( filename ); static CharDriverState *qemu_chr_open_tty(const char *filename) int fd ; TFR ( fd = open ( filename , O_RDWR | O_NONBLOCK ) ); tty_serial_init ( fd , 115200 , 'N' , 8 , 1 ); static void tty_serial_init(int fd, int int parity, int data_bits, int stop_bits) printf ( "tty_serial_init: speed=%d parity=%c data=%d stop=%d\n" , speed , parity , data_bits , stop_bits ); tcgetattr ( fd , & tty ); if ( speed <= 50 * MARGIN )  if ( speed <= 75 * MARGIN )  if ( speed <= 300 * MARGIN )  if ( speed <= 600 * MARGIN )  if ( speed <= 1200 * MARGIN )  if ( speed <= 2400 * MARGIN )  if ( speed <= 4800 * MARGIN )  if ( speed <= 9600 * MARGIN )  if ( speed <= 19200 * MARGIN )  if ( speed <= 38400 * MARGIN )  if ( speed <= 57600 * MARGIN )  if ( speed <= 115200 * MARGIN )  switch ( data_bits )  switch ( parity )  if ( stop_bits == 2 )  tcsetattr ( fd , TCSANOW , & tty ); chr = qemu_chr_open_fd ( fd , fd ); static CharDriverState *qemu_chr_open_fd(int fd_in, int fd_out) s -> fd_in = fd_in; s -> fd_out = fd_out; chr -> opaque = s; chr -> chr_write = fd_chr_write; chr -> chr_update_read_handler = fd_chr_update_read_handler; chr -> chr_close = fd_chr_close; qemu_chr_reset ( chr ); void qemu_chr_reset(CharDriverState *s) if ( s -> bh == NULL && initial_reset_issued )  s -> bh = qemu_bh_new ( qemu_chr_reset_bh , s ); qemu_bh_schedule ( s -> bh ); return chr ; if ( ! chr )  close ( fd ); chr -> chr_ioctl = tty_serial_ioctl; qemu_chr_reset ( chr ); void qemu_chr_reset(CharDriverState *s) if ( s -> bh == NULL && initial_reset_issued )  s -> bh = qemu_bh_new ( qemu_chr_reset_bh , s ); qemu_bh_schedule ( s -> bh ); return chr ; 