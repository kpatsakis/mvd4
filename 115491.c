static ssize_t mcf_fec_receive(NetClientState *nc, const uint8_t *buf, size_t size) mcf_fec_state * s = qemu_get_nic_opaque ( nc ) ; mcf_fec_bd bd ; uint32_t flags = 0 ; unsigned int buf_len ; if ( ! s -> rx_enabled )  fprintf ( stderr , "mcf_fec_receive: Unexpected packet\n" ); size += 4; if ( size > FEC_MAX_FRAME_SIZE )  size = FEC_MAX_FRAME_SIZE; flags |= FEC_BD_TR | FEC_BD_LG; if ( size > ( s -> rcr >> 16 ) )  flags |= FEC_BD_LG; while ( size > 0 )  if ( ( bd . flags & FEC_BD_E ) == 0 )  fprintf ( stderr , "mcf_fec: Lost end of frame\n" ); buf_len = ( size <= s -> emrbr ) ? size : s -> emrbr; bd . length = buf_len; size -= buf_len; bd . flags &= ~FEC_BD_E; if ( size == 0 )  bd . flags |= flags | FEC_BD_L; s -> eir |= FEC_INT_RXF; s -> eir |= FEC_INT_RXB; 