static void xhci_oper_write(void *ptr, hwaddr uint64_t val, unsigned size) XHCIState * xhci = ptr ; switch ( reg )  if ( val & USBCMD_CSS )  xhci -> usbsts &= ~USBSTS_SRE; if ( val & USBCMD_CRS )  xhci -> usbsts |= USBSTS_SRE; xhci -> usbcmd = val & 0xc0f; xhci -> usbsts &= ~ ( val & ( USBSTS_HSE | USBSTS_EINT | USBSTS_PCD | USBSTS_SRE ) ); xhci -> dnctrl = val & 0xffff; xhci -> crcr_low = ( val & 0xffffffcf ) | ( xhci -> crcr_low & CRCR_CRR ); xhci -> crcr_high = val; if ( xhci -> crcr_low & ( CRCR_CA | CRCR_CS ) && ( xhci -> crcr_low & CRCR_CRR ) )  xhci -> crcr_low &= ~CRCR_CRR; xhci_event ( xhci , & event , 0 ); static void xhci_event(XHCIState *xhci, XHCIEvent *event, int v) XHCIInterrupter * intr ; dma_addr_t erdp ; unsigned int dp_idx ; if ( v >= xhci -> numintrs )  intr = & xhci -> intr [ v ]; if ( intr -> er_full )  erdp = xhci_addr64 ( intr -> erdp_low , intr -> erdp_high ); static inline dma_addr_t xhci_addr64(uint32_t low, uint32_t high) if ( sizeof ( dma_addr_t ) == 4 )  return low ; return low | ( ( ( dma_addr_t ) high << 16 ) << 16 ) ; if ( erdp < intr -> er_start || erdp >= ( intr -> er_start + TRB_SIZE * intr -> er_size ) )  dp_idx = ( erdp - intr -> er_start ) / TRB_SIZE; assert ( dp_idx < intr -> er_size ); 