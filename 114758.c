int sock_setsockopt(struct socket *sock, int level, int char __user *optval, unsigned int optlen) struct sock * sk = sock -> sk ; if ( optname == SO_BINDTODEVICE )  return sock_setbindtodevice ( sk , optval , optlen ) ; static int sock_setbindtodevice(struct sock *sk, char __user int optlen) struct net * net = sock_net ( sk ) ; char devname [ IFNAMSIZ ] ; if ( ! ns_capable ( net -> user_ns , CAP_NET_RAW ) )  if ( optlen < 0 )  memset ( devname , 0 , sizeof ( devname ) ); if ( copy_from_user ( devname , optval , optlen ) )  if ( devname [ 0 ] != '\0' )  dev = dev_get_by_name_rcu ( net , devname ); if ( dev )  index = dev -> ifindex; if ( ! dev )  sk -> sk_bound_dev_if = index; sk_dst_reset ( sk ); release_sock ( sk ); void release_sock(struct sock *sk) spin_lock_bh ( & sk -> sk_lock . slock ); if ( sk -> sk_backlog . tail )  __release_sock ( sk ); if ( sk -> sk_prot -> release_cb )  sk -> sk_prot -> release_cb ( sk ); sock_release_ownership ( sk ); if ( waitqueue_active ( & sk -> sk_lock . wq ) )  wake_up ( & sk -> sk_lock . wq ); spin_unlock_bh ( & sk -> sk_lock . slock ); 