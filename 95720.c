static int pty_chr_write(CharDriverState *chr, const uint8_t *buf, int len) PtyCharDriver * s = chr -> opaque ; if ( ! s -> connected )  return send_all ( s -> fd , buf , len ) ; int send_all(int fd, const void *buf, int len1) return unix_write ( fd , buf , len1 ) ; static int unix_write(int fd, const uint8_t *buf, int len1) int ret , len ; len = len1; while ( len > 0 )  ret = write ( fd , buf , len ); if ( ret < 0 )  if ( errno != EINTR && errno != EAGAIN )  if ( ret == 0 )  buf += ret; len -= ret; return len1 - len ; 