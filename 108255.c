static int arcmsr_queue_command_lck(struct scsi_cmnd void (* done)(struct scsi_cmnd *)) struct Scsi_Host * host = cmd -> device -> host ; struct AdapterControlBlock * acb = ( struct AdapterControlBlock * ) host -> hostdata ; int target = cmd -> device -> id ; uint8_t scsicmd = cmd -> cmnd [ 0 ] ; if ( ( scsicmd == SYNCHRONIZE_CACHE ) || ( scsicmd == SEND_DIAGNOSTIC ) )  if ( target == 16 )  arcmsr_handle_virtual_command ( acb , cmd ); static void arcmsr_handle_virtual_command(struct AdapterControlBlock struct scsi_cmnd *cmd) switch ( cmd -> cmnd [ 0 ] )  unsigned char inqdata [ 36 ] ; char * buffer ; struct scatterlist * sg ; if ( cmd -> device -> lun )  inqdata [ 0 ] = TYPE_PROCESSOR; inqdata [ 1 ] = 0; inqdata [ 2 ] = 0; inqdata [ 4 ] = 31; sg = scsi_sglist ( cmd ); buffer = kmap_atomic ( sg_page ( sg ) ) + sg -> offset; memcpy ( buffer , inqdata , sizeof ( inqdata ) ); kunmap_atomic ( buffer - sg -> offset ); 