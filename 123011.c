static struct wireless_dev *brcmf_cfg80211_add_iface(struct wiphy const char unsigned char enum nl80211_iftype u32 struct vif_params *params) struct wireless_dev * wdev ; int err ; err = brcmf_vif_add_validate ( wiphy_to_cfg ( wiphy ) , type ); static int brcmf_vif_add_validate(struct brcmf_cfg80211_info enum nl80211_iftype new_type) int iftype_num [ NUM_NL80211_IFTYPES ] ; struct brcmf_cfg80211_vif * pos ; iftype_num [ pos -> wdev . iftype ] ++; iftype_num [ new_type ] ++; return cfg80211_check_combinations ( cfg -> wiphy , 1 , 0 , iftype_num ) ; if ( err )  switch ( type )  wdev = brcmf_ap_add_vif ( wiphy , name , flags , params );  struct wireless_dev *brcmf_ap_add_vif(struct wiphy *wiphy, const char u32 *flags, struct vif_params *params) struct brcmf_cfg80211_info * cfg = wiphy_to_cfg ( wiphy ) ; struct brcmf_cfg80211_vif * vif ; if ( brcmf_cfg80211_vif_event_armed ( cfg ) )  bool brcmf_cfg80211_vif_event_armed(struct brcmf_cfg80211_info *cfg) struct brcmf_cfg80211_vif_event * event = & cfg -> vif_event ; bool armed ; armed = event -> vif != NULL; return armed ; vif = brcmf_alloc_vif ( cfg , NL80211_IFTYPE_AP , false ); struct brcmf_cfg80211_vif *brcmf_alloc_vif(struct brcmf_cfg80211_info enum nl80211_iftype bool pm_block) struct brcmf_cfg80211_vif * vif ; vif = kzalloc ( sizeof ( * vif ) , GFP_KERNEL ); if ( ! vif )  vif -> wdev . wiphy = cfg -> wiphy; vif -> wdev . iftype = type; vif -> pm_block = pm_block; brcmf_init_prof ( & vif -> profile ); static void brcmf_init_prof(struct brcmf_cfg80211_profile *prof) memset ( prof , 0 , sizeof ( * prof ) ); 