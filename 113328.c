float *build_input_gamma_table(struct curveType *TRC) float * gamma_table ; if ( ! TRC )  gamma_table = malloc ( sizeof ( float ) * 256 ); if ( gamma_table )  compute_curve_gamma_table_type_parametric ( gamma_table , TRC -> parameter , TRC -> count ); void compute_curve_gamma_table_type_parametric(float gamma_table[256], float parameter[7], int count) float y = parameter [ 0 ] ; if ( count == 0 )  if ( count == 1 )  a = parameter [ 1 ]; b = parameter [ 2 ]; interval = - 1 * parameter [ 2 ] / parameter [ 1 ]; if ( count == 2 )  a = parameter [ 1 ]; b = parameter [ 2 ]; e = parameter [ 3 ]; f = parameter [ 3 ]; interval = - 1 * parameter [ 2 ] / parameter [ 1 ]; if ( count == 3 )  a = parameter [ 1 ]; b = parameter [ 2 ]; c = parameter [ 3 ]; e = - c; interval = parameter [ 4 ]; if ( count == 4 )  a = parameter [ 1 ]; b = parameter [ 2 ]; c = parameter [ 3 ]; e = parameter [ 5 ] - c; f = parameter [ 6 ]; interval = parameter [ 4 ]; if ( X >= interval )  gamma_table [ X ] = clamp_float ( pow ( a * X / 255. + b , y ) + c + e ); gamma_table [ X ] = clamp_float ( c * X / 255. + f ); compute_curve_gamma_table_type0 ( gamma_table ); void compute_curve_gamma_table_type0(float gamma_table[256]) gamma_table [ i ] = i / 255.; compute_curve_gamma_table_type1 ( gamma_table , TRC -> data [ 0 ] ); void compute_curve_gamma_table_type1(float gamma_table[256], uint16_t gamma) float gamma_float = u8Fixed8Number_to_float ( gamma ) ; gamma_table [ i ] = pow ( i / 255. , gamma_float ); compute_curve_gamma_table_type2 ( gamma_table , TRC -> data , TRC -> count ); void compute_curve_gamma_table_type2(float gamma_table[256], uint16_t *table, int length) gamma_table [ i ] = lut_interp_linear ( i / 255. , table , length ); float lut_interp_linear(double input_value, uint16_t *table, int length) input_value = input_value * ( length - 1 ); upper = ceil ( input_value ); lower = floor ( input_value ); value = table [ upper ] * ( 1. - ( upper - input_value ) ) + table [ lower ] * ( upper - input_value ); return value * ( 1.f / 65535.f ) ; return gamma_table ; 