int CVE_2012_5532_VULN_main(void) int fd , len , sock_opt ; fd = socket ( AF_NETLINK , SOCK_DGRAM , NETLINK_CONNECTOR ); if ( fd < 0 )  syslog ( LOG_ERR , "netlink socket creation failed; error:%d" , fd ); error = bind ( fd , ( struct sockaddr * ) & addr , sizeof ( addr ) ); if ( error < 0 )  syslog ( LOG_ERR , "bind failed; error:%d" , error ); close ( fd ); setsockopt ( fd , 270 , 1 , & sock_opt , sizeof ( sock_opt ) ); len = netlink_send ( fd , message ); if ( len < 0 )  syslog ( LOG_ERR , "netlink_send failed; error:%d" , len ); close ( fd ); pfd . fd = fd; pfd . events = POLLIN; pfd . revents = 0; poll ( & pfd , 1 , - 1 ); len = recvfrom ( fd , kvp_recv_buffer , sizeof ( kvp_recv_buffer ) , 0 , addr_p , & addr_l ); if ( len < 0 || addr . nl_pid )  close ( fd ); op = hv_msg -> kvp_hdr . operation; pool = hv_msg -> kvp_hdr . pool; if ( ( in_hand_shake ) && ( op == KVP_OP_REGISTER1 ) )  switch ( op )  if ( error )  hv_msg -> error = error; if ( error )  hv_msg -> error = error; if ( kvp_key_add_or_modify ( pool , hv_msg -> body . kvp_set . data . key , hv_msg -> body . kvp_set . data . key_size , hv_msg -> body . kvp_set . data . value , hv_msg -> body . kvp_set . data . value_size ) )  if ( kvp_get_value ( pool , hv_msg -> body . kvp_set . data . key , hv_msg -> body . kvp_set . data . key_size , hv_msg -> body . kvp_set . data . value , hv_msg -> body . kvp_set . data . value_size ) )  if ( kvp_key_delete ( pool , hv_msg -> body . kvp_delete . key , hv_msg -> body . kvp_delete . key_size ) )  if ( op != KVP_OP_ENUMERATE )  if ( pool != KVP_POOL_AUTO )  if ( kvp_pool_enumerate ( pool , hv_msg -> body . kvp_enum_data . index , hv_msg -> body . kvp_enum_data . data . key , HV_KVP_EXCHANGE_MAX_KEY_SIZE , hv_msg -> body . kvp_enum_data . data . value , HV_KVP_EXCHANGE_MAX_VALUE_SIZE ) )  key_name = ( char * ) hv_msg -> body . kvp_enum_data . data . key; key_value = ( char * ) hv_msg -> body . kvp_enum_data . data . value; switch ( hv_msg -> body . kvp_enum_data . index )  kvp_get_domain_name ( key_value , HV_KVP_EXCHANGE_MAX_VALUE_SIZE ); strcpy ( key_name , "FullyQualifiedDomainName" ); strcpy ( key_name , "IntegrationServicesVersion" ); strcpy ( key_value , lic_version ); kvp_get_ip_info ( AF_INET , NULL , KVP_OP_ENUMERATE , key_value , HV_KVP_EXCHANGE_MAX_VALUE_SIZE ); strcpy ( key_name , "NetworkAddressIPv4" ); kvp_get_ip_info ( AF_INET6 , NULL , KVP_OP_ENUMERATE , key_value , HV_KVP_EXCHANGE_MAX_VALUE_SIZE ); strcpy ( key_name , "NetworkAddressIPv6" ); strcpy ( key_value , os_build ); strcpy ( key_name , "OSBuildNumber" ); strcpy ( key_value , os_name ); strcpy ( key_name , "OSName" ); strcpy ( key_value , os_major ); strcpy ( key_name , "OSMajorVersion" ); strcpy ( key_value , os_minor ); strcpy ( key_name , "OSMinorVersion" ); strcpy ( key_value , os_build ); strcpy ( key_name , "OSVersion" ); strcpy ( key_value , processor_arch ); strcpy ( key_name , "ProcessorArchitecture" ); len = netlink_send ( fd , incoming_cn_msg ); if ( len < 0 )  syslog ( LOG_ERR , "net_link send failed; error:%d" , len ); 