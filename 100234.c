static void xhci_reset(DeviceState *dev) XHCIState * xhci = XHCI ( dev ) ; int i ; xhci -> usbcmd = 0; xhci -> usbsts = USBSTS_HCH; xhci -> dnctrl = 0; xhci -> crcr_low = 0; xhci -> crcr_high = 0; xhci -> dcbaap_low = 0; xhci -> dcbaap_high = 0; xhci -> config = 0; for (i = 0; i < xhci->numslots; i++) for (i = 0; i < xhci->numports; i++) xhci_port_update ( xhci -> ports + i , 0 ); static void xhci_port_update(XHCIPort *port, int is_detach) xhci_port_notify ( port , PORTSC_CSC ); static void xhci_port_notify(XHCIPort *port, uint32_t bits) if ( ( port -> portsc & bits ) == bits )  port -> portsc |= bits; if ( ! xhci_running ( port -> xhci ) )  xhci_event ( port -> xhci , & ev , 0 ); static void xhci_event(XHCIState *xhci, XHCIEvent *event, int v) XHCIInterrupter * intr ; dma_addr_t erdp ; unsigned int dp_idx ; if ( v >= xhci -> numintrs )  intr = & xhci -> intr [ v ]; if ( intr -> er_full )  erdp = xhci_addr64 ( intr -> erdp_low , intr -> erdp_high ); if ( erdp < intr -> er_start || erdp >= ( intr -> er_start + TRB_SIZE * intr -> er_size ) )  dp_idx = ( erdp - intr -> er_start ) / TRB_SIZE; assert ( dp_idx < intr -> er_size ); 