static int32_t scsi_target_send_command(SCSIRequest *req, uint8_t *buf) SCSITargetReq * r = DO_UPCAST ( SCSITargetReq , req , req ) ; switch ( buf [ 0 ] )  if ( ! scsi_target_emulate_report_luns ( r ) )  if ( ! scsi_target_emulate_inquiry ( r ) )  scsi_req_complete ( req , CHECK_CONDITION ); void scsi_req_complete(SCSIRequest *req, int status) req -> status = status; if ( status == GOOD )  req -> sense_len = 0; if ( req -> sense_len )  memcpy ( req -> dev -> sense , req -> sense , req -> sense_len ); req -> dev -> sense_len = req -> sense_len; req -> dev -> sense_is_ua = ( req -> ops == & reqops_unit_attention ); req -> bus -> info -> complete ( req , req -> status , req -> resid ); 