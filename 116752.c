static brcmf_cfg80211_mgmt_tx(struct wiphy *wiphy, struct wireless_dev struct cfg80211_mgmt_tx_params *params, u64 *cookie) struct brcmf_cfg80211_info * cfg = wiphy_to_cfg ( wiphy ) ; const u8 * buf = params -> buf ; size_t len = params -> len ; const struct ieee80211_mgmt * mgmt ; struct brcmf_cfg80211_vif * vif ; s32 ie_offset ; s32 ie_len ; mgmt = ( const struct ieee80211_mgmt * ) buf; if ( ! ieee80211_is_mgmt ( mgmt -> frame_control ) )  vif = container_of ( wdev , struct brcmf_cfg80211_vif , wdev ) if ( ieee80211_is_probe_resp ( mgmt -> frame_control ) )  ie_offset = DOT11_MGMT_HDR_LEN + DOT11_BCN_PRB_FIXED_LEN; ie_len = len - ie_offset; if ( vif == cfg -> p2p . bss_idx [ P2PAPI_BSSCFG_PRIMARY ] . vif )  vif = cfg -> p2p . bss_idx [ P2PAPI_BSSCFG_DEVICE ] . vif; err = brcmf_vif_set_mgmt_ie ( vif , BRCMF_VNDR_IE_PRBRSP_FLAG , & buf [ ie_offset ] , ie_len ); s32 brcmf_vif_set_mgmt_ie(struct brcmf_cfg80211_vif *vif, s32 const u8 *vndr_ie_buf, u32 vndr_ie_len) struct vif_saved_ie * saved_ie ; u8 * iovar_ie_buf ; u8 * curr_ie_buf ; int mgmt_ie_buf_len ; struct parsed_vndr_ies new_vndr_ies ; if ( ! vif )  saved_ie = & vif -> saved_ie; iovar_ie_buf = kzalloc ( WL_EXTRA_BUF_MAX , GFP_KERNEL ); if ( ! iovar_ie_buf )  curr_ie_buf = iovar_ie_buf; switch ( pktflag )  mgmt_ie_buf_len = sizeof ( saved_ie -> probe_req_ie ); mgmt_ie_buf_len = sizeof ( saved_ie -> probe_res_ie ); mgmt_ie_buf_len = sizeof ( saved_ie -> beacon_ie ); mgmt_ie_buf_len = sizeof ( saved_ie -> assoc_req_ie ); if ( vndr_ie_len > mgmt_ie_buf_len )  if ( vndr_ie_buf && vndr_ie_len && curr_ie_buf )  brcmf_parse_vndr_ies ( vndr_ie_buf , vndr_ie_len , & new_vndr_ies ); static brcmf_parse_vndr_ies(const u8 *vndr_ie_buf, u32 struct parsed_vndr_ies *vndr_ies) struct brcmf_vs_tlv * vndrie ; struct brcmf_tlv * ie ; struct parsed_vndr_ie_info * parsed_info ; s32 remaining_len ; remaining_len = ( s32 ) vndr_ie_len; memset ( vndr_ies , 0 , sizeof ( * vndr_ies ) ); ie = ( struct brcmf_tlv * ) vndr_ie_buf; while ( ie )  if ( ie -> id != WLAN_EID_VENDOR_SPECIFIC )  vndrie = ( struct brcmf_vs_tlv * ) ie; if ( vndrie -> len < ( VS_IE_FIXED_HDR_LEN - TLV_HDR_LEN + 1 ) )  if ( ! memcmp ( vndrie -> oui , ( u8 * ) WPA_OUI , TLV_OUI_LEN ) && ( ( vndrie -> oui_type == WPA_OUI_TYPE ) || ( vndrie -> oui_type == WME_OUI_TYPE ) ) )  parsed_info = & vndr_ies -> ie_info [ vndr_ies -> count ]; parsed_info -> ie_ptr = ( char * ) vndrie; parsed_info -> ie_len = vndrie -> len + TLV_HDR_LEN; memcpy ( & parsed_info -> vndrie , vndrie , sizeof ( * vndrie ) ); vndr_ies -> count ++; brcmf_dbg ( TRACE , "** OUI %02x %02x %02x, type 0x%02x\n" , parsed_info -> vndrie . oui [ 0 ] , parsed_info -> vndrie . oui [ 1 ] , parsed_info -> vndrie . oui [ 2 ] , parsed_info -> vndrie . oui_type ); if ( vndr_ies -> count >= VNDR_IE_PARSE_LIMIT )  remaining_len -= ( ie -> len + TLV_HDR_LEN ); if ( remaining_len <= TLV_HDR_LEN )  ie = NULL; ie = ( struct brcmf_tlv * ) ( ( ( u8 * ) ie ) + ie -> len + TLV_HDR_LEN ); 