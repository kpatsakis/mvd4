static void megasas_write_sense(MegasasCmd *cmd, SCSISense sense) uint8_t sense_buf [ SCSI_SENSE_BUF_SIZE ] ; uint8_t sense_len = 18 ; memset ( sense_buf , 0 , sense_len ); sense_buf [ 0 ] = 0xf0; sense_buf [ 2 ] = sense . key; sense_buf [ 7 ] = 10; sense_buf [ 12 ] = sense . asc; sense_buf [ 13 ] = sense . ascq; megasas_build_sense ( cmd , sense_buf , sense_len ); static int megasas_build_sense(MegasasCmd *cmd, uint8_t uint8_t sense_len) PCIDevice * pcid = PCI_DEVICE ( cmd -> state ) ; if ( sense_len > cmd -> frame -> header . sense_len )  sense_len = cmd -> frame -> header . sense_len; if ( sense_len )  pa_lo = le32_to_cpu ( cmd -> frame -> pass . sense_addr_lo ); if ( megasas_frame_is_sense64 ( cmd ) )  static bool megasas_frame_is_sense64(MegasasCmd *cmd) return cmd -> flags & MFI_FRAME_SENSE64 ; pa_hi = le32_to_cpu ( cmd -> frame -> pass . sense_addr_hi ); pa = ( ( uint64_t ) pa_hi << 32 ) | pa_lo; pci_dma_write ( pcid , pa , sense_ptr , sense_len ); cmd -> frame -> header . sense_len = sense_len; return sense_len ; 