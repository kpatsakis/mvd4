static int megasas_dcmd_cfg_read(MegasasState *s, MegasasCmd *cmd) uint8_t data [ 4096 ] ; struct mfi_config_data * info ; int num_pd_disks = 0 , array_offset , ld_offset ; if ( cmd -> iov_size > 4096 )  num_pd_disks ++; info = ( struct mfi_config_data * ) & data; info -> array_count = num_pd_disks; info -> array_size = sizeof ( struct mfi_array ) * num_pd_disks; info -> log_drv_count = num_pd_disks; info -> log_drv_size = sizeof ( struct mfi_ld_config ) * num_pd_disks; info -> spares_count = 0; info -> spares_size = sizeof ( struct mfi_spare ); info -> size = sizeof ( struct mfi_config_data ) + info -> array_size + info -> log_drv_size; if ( info -> size > 4096 )  array_offset = sizeof ( struct mfi_config_data ); ld_offset = array_offset + sizeof ( struct mfi_array ) * num_pd_disks; struct mfi_ld_config * ld ; ld = ( struct mfi_ld_config * ) ( data + ld_offset ); memset ( ld , 0 , sizeof ( struct mfi_ld_config ) ); ld -> properties . ld . v . target_id = sdev -> id; ld -> properties . default_cache_policy = MR_LD_CACHE_READ_AHEAD | MR_LD_CACHE_READ_ADAPTIVE; ld -> properties . current_cache_policy = MR_LD_CACHE_READ_AHEAD | MR_LD_CACHE_READ_ADAPTIVE; ld -> params . state = MFI_LD_STATE_OPTIMAL; ld -> params . stripe_size = 3; ld -> params . num_drives = 1; ld -> params . span_depth = 1; ld -> params . is_consistent = 1; ld -> span [ 0 ] . start_block = 0; ld -> span [ 0 ] . num_blocks = cpu_to_le64 ( pd_size ); ld -> span [ 0 ] . array_ref = cpu_to_le16 ( sdev_id ); 