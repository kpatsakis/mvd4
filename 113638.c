CPUArchState *cpu_copy(CPUArchState *env) CPUArchState * new_env = cpu_init ( env -> cpu_model_str ) ; memcpy ( new_env , env , sizeof ( CPUArchState ) ); cpu_breakpoint_insert ( new_env , bp -> pc , bp -> flags , NULL ); int cpu_breakpoint_insert(CPUArchState *env, target_ulong pc, int CPUBreakpoint **breakpoint) bp -> pc = pc; bp -> flags = flags; if ( flags & BP_GDB )  QTAILQ_INSERT_HEAD ( & env -> breakpoints , bp , entry ); QTAILQ_INSERT_TAIL ( & env -> breakpoints , bp , entry ); breakpoint_invalidate ( ENV_GET_CPU ( env ) , pc ); static void breakpoint_invalidate(CPUState *cpu, target_ulong pc) tb_invalidate_phys_page_range ( pc , pc + 1 , 0 ); if ( breakpoint )  * breakpoint = bp; cpu_watchpoint_insert ( new_env , wp -> vaddr , ( ~wp -> len_mask ) + 1 , wp -> flags , NULL ); int cpu_watchpoint_insert(CPUArchState *env, target_ulong addr, target_ulong int flags, CPUWatchpoint **watchpoint) return new_env ; 