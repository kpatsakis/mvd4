int ff_get_buffer(AVCodecContext *avctx, AVFrame *frame, int flags) int ret = get_buffer_internal ( avctx , frame , flags ) ; static int get_buffer_internal(AVCodecContext *avctx, AVFrame *frame, int flags) int ret ; if ( avctx -> codec_type == AVMEDIA_TYPE_VIDEO )  if ( ( ret = av_image_check_size ( avctx -> width , avctx -> height , 0 , avctx ) ) < 0 || avctx -> pix_fmt < 0 )  if ( avctx -> codec_type == AVMEDIA_TYPE_VIDEO )  if ( frame -> width <= 0 || frame -> height <= 0 )  frame -> width = FFMAX ( avctx -> width , FF_CEIL_RSHIFT ( avctx -> coded_width , avctx -> lowres ) ); frame -> height = FFMAX ( avctx -> height , FF_CEIL_RSHIFT ( avctx -> coded_height , avctx -> lowres ) ); ret = ff_decode_frame_props ( avctx , frame ); int ff_decode_frame_props(AVCodecContext *avctx, AVFrame *frame) return ff_init_buffer_info ( avctx , frame ) ; int ff_init_buffer_info(AVCodecContext *avctx, AVFrame *frame) AVPacket * pkt = avctx -> internal -> pkt ; int i ; sd [ ] AV_PKT_DATA_REPLAYGAIN , AV_FRAME_DATA_REPLAYGAIN AV_PKT_DATA_DISPLAYMATRIX , AV_FRAME_DATA_DISPLAYMATRIX AV_PKT_DATA_STEREO3D , AV_FRAME_DATA_STEREO3D AV_PKT_DATA_AUDIO_SERVICE_TYPE , AV_FRAME_DATA_AUDIO_SERVICE_TYPE , if ( pkt )  frame -> pkt_pts = pkt -> pts; for (i = 0; i < FF_ARRAY_ELEMS(sd); i++) int size ; uint8_t * packet_sd = av_packet_get_side_data ( pkt , sd [ i ] . packet , & size ) ; if ( packet_sd )  AVFrameSideData * frame_sd = av_frame_new_side_data ( frame , sd [ i ] . frame , size ) ; if ( ! frame_sd )  memcpy ( frame_sd -> data , packet_sd , size ); 