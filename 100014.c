static int32_t scsi_target_send_command(SCSIRequest *req, uint8_t *buf) SCSITargetReq * r = DO_UPCAST ( SCSITargetReq , req , req ) ; switch ( buf [ 0 ] )  if ( ! scsi_target_emulate_inquiry ( r ) )  static bool scsi_target_emulate_inquiry(SCSITargetReq *r) if ( r -> req . cmd . buf [ 1 ] & 0x2 )  if ( r -> req . cmd . buf [ 1 ] & 0x1 )  uint8_t page_code = r -> req . cmd . buf [ 2 ] ; r -> buf [ r -> len ++ ] = page_code; r -> buf [ r -> len ++ ] = 0x00; switch ( page_code )  int pages ; pages = r -> len ++; r -> buf [ r -> len ++ ] = 0x00; r -> buf [ pages ] = r -> len - pages - 1; assert ( r -> len < r -> buf_len ); 